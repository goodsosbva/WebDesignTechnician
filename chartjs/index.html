<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart.js Data Preprocessing</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div style="width: 700px;">
        <canvas id="myDynamicStackedChart"></canvas>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // ìº”ë²„ìŠ¤ ìš”ì†Œ
    const ctx = document.getElementById('myDynamicStackedChart').getContext('2d');
    
    // ğŸš€ ì›ë³¸ ë°ì´í„° (í•˜ë‚˜ì˜ ë§‰ëŒ€ì— ì—¬ëŸ¬ íƒ€ì…ì´ í¬í•¨ëœ í˜•íƒœ)
    const rawData = [
        [[10, 'ìœ„í—˜'], [20, 'ì¼ë°˜'], [30, 'ì‹¬ê°']], // ì²« ë²ˆì§¸ ë§‰ëŒ€
        [[5, 'ìœ„í—˜'], [30, 'ì¼ë°˜'], [25, 'ì‹¬ê°']],  // ë‘ ë²ˆì§¸ ë§‰ëŒ€
        [[15, 'ìœ„í—˜'], [15, 'ì¼ë°˜'], [40, 'ì‹¬ê°']] // ì„¸ ë²ˆì§¸ ë§‰ëŒ€
    ];

    // Xì¶• ë ˆì´ë¸” (ê°€ì •: ë§‰ëŒ€ì˜ ìˆœì„œëŒ€ë¡œ 'Day 1', 'Day 2', 'Day 3'ìœ¼ë¡œ ì§€ì •)
    const labels = ['Day 1', 'Day 2', 'Day 3'];

    // ğŸ¨ íƒ€ì…ë³„ ìƒ‰ìƒ ë§¤í•‘ (ì„ íƒ ì‚¬í•­: ì‹œê°ì  êµ¬ë¶„ì„ ìœ„í•´ ì •ì˜)
    const colorMap = {
        'ìœ„í—˜': 'rgba(255, 99, 132, 0.8)', // ë¶‰ì€ìƒ‰
        'ì¼ë°˜': 'rgba(54, 162, 235, 0.8)', // í‘¸ë¥¸ìƒ‰
        'ì‹¬ê°': 'rgba(255, 206, 86, 0.8)'  // ë…¸ë€ìƒ‰
    };

    // --- 1ë‹¨ê³„: ëª¨ë“  ê³ ìœ  íƒ€ì…(ìŠ¤íƒ ë ˆì´ë¸”) ì¶”ì¶œ ---
    const uniqueTypes = new Set();
    rawData.forEach(barData => {
        barData.forEach(item => {
            uniqueTypes.add(item[1]); // item[1]ì€ 'ìœ„í—˜', 'ì¼ë°˜', 'ì‹¬ê°'
        });
    });
    const typeLabels = Array.from(uniqueTypes); // ['ìœ„í—˜', 'ì¼ë°˜', 'ì‹¬ê°']

    // --- 2ë‹¨ê³„: Chart.js í¬ë§·ì— ë§ê²Œ ë°ì´í„°ì…‹ ìƒì„± ---
    const datasets = typeLabels.map(type => {
        // ê° íƒ€ì…ë³„ ë°ì´í„° ë°°ì—´ì„ ë§Œë“­ë‹ˆë‹¤. (ì˜ˆ: ìœ„í—˜ ë°ì´í„°ì…‹ì˜ data)
        const dataForType = rawData.map(barData => {
            // í˜„ì¬ ë§‰ëŒ€(barData)ì—ì„œ í•´ë‹¹ íƒ€ì…(type)ì˜ ê°’ì„ ì°¾ìŠµë‹ˆë‹¤.
            const item = barData.find(d => d[1] === type);
            return item ? item[0] : 0; // ê°’ì´ ìˆìœ¼ë©´ í•´ë‹¹ ê°’(ìˆ«ì)ì„, ì—†ìœ¼ë©´ 0ì„ ë°˜í™˜
        });

        // Chart.js ë°ì´í„°ì…‹ ê°ì²´ ë°˜í™˜
        return {
            label: type,
            data: dataForType,
            backgroundColor: colorMap[type],
            borderColor: colorMap[type].replace('0.8', '1'),
            borderWidth: 1
        };
    });

    // --- 3ë‹¨ê³„: Chart.js ë Œë”ë§ ---
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: datasets,
        },
        options: {
            responsive: true,
            scales: {
                x: {
                    stacked: true // Xì¶• ìŠ¤íƒ í™œì„±í™”
                },
                y: {
                    beginAtZero: true,
                    stacked: true // Yì¶• ìŠ¤íƒ í™œì„±í™”
                }
            },
            plugins: {
                title: {
                    display: true,
                    text: 'ë™ì  ë°ì´í„° ê¸°ë°˜ ìŠ¤íƒí˜• ë§‰ëŒ€ ê·¸ë˜í”„'
                },
                tooltip: {
                    mode: 'index',
                    intersect: false
                }
            }
        }
    });
});
</script>
</body>
</html>